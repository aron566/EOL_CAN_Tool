# EOL_CAN_Tool上位机说明

| 日期      | 修订内容                      | 版本   | 修订人 |
| --------- | ----------------------------- | ------ | ------ |
| 2023.12.1 | 初版                          | v0.0.1 | Aron   |
| 2024.1.29 | 更新软件更新说明，EOL协议说明 | v0.0.2 | Aron   |
|           |                               |        |        |

[toc]

## 上位机功能

- 多品牌厂商can设备支持
  - 周立功全系
  - 广成 can / canfd
  - 同星
  - kvaser全系

- CAN数据通讯测试
  - 报文转换（将指定CANID报文 CANFD->CAN 或是 CAN->CANFD）
  - 队列定时发送
  - 队列定次发送
  - 手动发送
  - 报文周期监控统计
- CAN串口调试功能
  - 将串口数据转为ascii形式显示，与串口工具类似
- RTS控制功能（UDP网络）
  - 设置中心频率
  - 设置带宽
  - 设置距离
  - 设置速度
  - 设置rcs
- PLC控制功能（Modbus TCP），即将支持....
- shell交互功能
  - 查看软件版本、SN
  - 设置/读取雷达内部运行参数
  - 雷达重启
  - 查看方向图
  - 依据雷达软件任意扩展功能，等等...
- EOL全功能
  - 获取2D数据
  - 目标刷新显示
  - DBF校准数据写入读取
  - 雷达版本SN信息读写
- 网络调试功能
  - UDP
  - TCP
- 曲线图表功能
  - 支持来自can / 网络 / 串口数据的曲线绘制（用于程序运行时间监控、变量数值监控）
- 软件更新

## 上位机界面

![image-20231229172400233](README.image/image-20231229172400233.png)

## EOL相关使用说明

### CAN设备连接

#### 选择设备

can设备连接好电脑后，依次选择`品牌`->`设备型号`->`通道`（选择打开第几个通道或者全部打开，编号从0开始）

**设备索引**是用于区分，多个同型号can设备连接到电脑

**设备信息**是用于读取设备的SN，通道数等信息，当可读时点击将弹窗显示

![企业微信截图_17038421916082](README.image/企业微信截图_17038421916082.png)

#### 设置通讯参数

![企业微信截图_17038427677856](README.image/企业微信截图_17038427677856.png)

#### 启动连接

依次点击：打开，初始化，启动

![企业微信截图_17038428798031](README.image/企业微信截图_17038428798031.png)

> 点击 更多则进入can通讯测试主页面，上方窗口将显示，设备是否打开启动成功

![image-20231229180042755](README.image/image-20231229180042755.png)

### CAN通讯测试

![企业微信截图_17038433943078](README.image/企业微信截图_17038433943078.png)

本页的功能：

- 支持两个以上通道数据的收发
- 支持掩码配置
- 支持将接收的数据转为字符串输出（可指定需转换can通道，指定需转换的canid）
- 手动发送报文
- 报文收发双色显示，带时间戳
- 提供进入其他菜单的按钮
- 手动发送窗口能够自动在数值尾部添加计算常用的crc值，点击一下相应的crc按钮，自动计算数据crc数值，追加在数据尾部显示

- 支持定时发送、定次发送

- 曲线图表功能，勾选可将数据转发至图表曲线显示

### EOL调试页面

![企业微信截图_17041606102856](README.image/企业微信截图_17041606102856.png)

本页的功能：

- 提供进入或者退出EOL模式的按钮，重启设备按钮
- 提供各种类型表的写入与读取，以及相应的进度显示
- 提供报文传输返回值显示
- 提供进入EOL模式后的信息读写测试页面、天线校准页面、rcs校准页面
- 进入下级页面的按钮

### 信息读写页面

![企业微信截图_170384410145](README.image/企业微信截图_170384410145.png)

本页功能：

- 实现版本、SN、mounID读写测试
- DTC检测
- VCAN测试

### 天线校准页面获取2D数据

![image-20230523134823419](README.image/image-20230523134823419.png)

![image-20230523135343721](README.image/image-20230523135343721.png)

本页功能：

- 设置目标模拟器rts的相关参数
- 设置转台水平转动相关参数
- 设置转台上下抬头相关参数
- 模拟发送转台信息给雷达，请求2DFFT数据
- 生成2DFFT数据csv

> 添加配置按钮属于增量式添加，如果需要重新配置，则需要先清除配置
>
> 当只需要添加某一个方向的2D数据，将其他方向的条件置空即可不采用

### RCS标定看目标

![企业微信截图_17038443232672](README.image/企业微信截图_17038443232672.png)

本页功能：

- 设定阈值
- 持续获取目标数据
- 通过**刷新显示过滤**设置，筛选出指定条件的目标方便观测、统计
- 统计目标设置，将进一步过滤目标输出到统计列表中



### SHELL调试

- shell调试支持控制台字体颜色切换
- 支持复制粘贴（复制后，使用鼠标右键粘贴）
- 支持`TAB`键补全命令
- 支持上下键查看历史命令
- 回车键执行命令

![Debug](README.image/Debug.gif)

## 网络调试

当前网络调试提供了两个网络设备提供调试功能：RTS，PLC

![企业微信截图_17041617782934](README.image/企业微信截图_17041617782934.png)

### RTS网络

RTS使用UDP通讯，**发送与接收端口区分**，所以在客户端网络即PC端网络需启用两个一个监听用于接收RTS发出的消息，一个用于发送控制RTS

RTS网络需要设置两个端口：客户端端口（发送端口），服务器端口（接收端口）

通讯IP设置为本机的局域网IP地址（与RTS在同一子网）

工作方式设置为`客户端`

点击`启动`按钮，启动成功后即可在**更多->EOL调试页面**看到RTS的控制按钮

![企业微信截图_17041622767946](README.image/企业微信截图_17041622767946.png)

### PLC网络



## 其他工具

### 曲线图表

> 曲线图表的功能进入

![企业微信截图_17041610671763](README.image/企业微信截图_17041610671763.png)

曲线图表要求输入方式为：$1 2 3;

- 以`$`开头
- 以`;`结尾
- 中间数字以`空格`隔开
- 1：代表通道0在当前时刻的数值
- 2：代表通道1在当前时刻的数值
- 3：代表通道2在当前时刻的数值

> C程序代码中可使用以下接口实现多通道数据的绘制显示：

```c
/**
 * @brief 格式化时间
 *
 * @param t 时间
 * @param ch 通道号
 * @param size 通道数
 */
void Show_Elapsed_Time(uint32_t t, uint32_t ch, uint32_t size)
{
  static char time_ms[64] = {0};
  if(1 == size)
  {
    EMBARC_PRINTF("$%u;\r\n", t);
  }
  else
  {
    if(ch == 0)
    {
      sprintf(time_ms, "$%u", t);
    }
    else
    {
      sprintf(time_ms + strlen(time_ms), " %u", t);
      if(ch == size - 1)
      {
        sprintf(time_ms + strlen(time_ms), ";\r\n");
        EMBARC_PRINTF(time_ms);
      }
    }
  }
}

/* 使用 */
uint32_t S = RTC_TO_MS(rtc_count());

track_read(bb->track);//需要测量的时间，通道0中显示

uint32_t E = RTC_TO_MS(rtc_count());
Show_Elapsed_Time(E - S, 0, 2);
S = RTC_TO_MS(rtc_count());

xxx();//需要测量的时间，通道1中显示

E = RTC_TO_MS(rtc_count());
Show_Elapsed_Time(E - S, 1, 2);
S = RTC_TO_MS(rtc_count());

xxx();//需要测量的时间，通道2中显示

E = RTC_TO_MS(rtc_count());
Show_Elapsed_Time(E - S, 2, 3);

```

![image-20240102100333915](README.image/image-20240102100333915.png)

#### 数据通道选择

![image-20240102102925461](README.image/image-20240102102925461.png)

- vcom代表虚拟通道，代表数据来自非串口设备（可通过勾选曲线图表，进行数据流转发）![image-20240102103111387](README.image/image-20240102103111387.png)
- 非vcom代表数据使用串口

## 工具更新功能

> 当有新软件版本发布，软件在每次启动时将提醒更新

![update](README.image/update.gif)

## 附录-EOL协议

- [EOL协议](doc/EOL数据传输协议.md)

